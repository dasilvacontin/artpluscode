<!doctype html5>
<head>
    <style>
        html, body {
            width: 100%;
            height: 100%;
            padding: 0;
            margin: 0
        }
        canvas {
            width: 600px;
            height: 600px;
        }
    </style>
</head>
<body>
<script>

let width, height
const canvas = document.createElement('canvas')
const ctx = canvas.getContext('2d')
document.body.appendChild(canvas)
const { abs, floor, max, PI, sin } = Math

/*
window.onresize = function () {
    width = window.innerWidth
    height = window.innerHeight
    canvas.width = width * 2
    canvas.height = height * 2
    ctx.scale(2, 2)
}
window.onresize()
*/
width = height = 600
canvas.width = width * 2
canvas.height = height * 2
ctx.scale(2, 2)

CanvasRenderingContext2D.prototype.fillCircle = function (centerX, centerY, radius) { this.beginPath()
    this.arc(centerX, centerY, radius, 0, 2 * Math.PI, false)
    this.fill()
}
</script>
<script src="render.js"></script>
<script>
let SPACING = 10
let count = 0

function renderSentence(sentence) {
    sentence.split(' ').forEach(word => {
        ctx.translate(0, 120)
        ctx.fillText(word, 0, 0)
    })
}

function isPixelPainted(imgData, x, y) {
    return (imgData.data[4 * (y * 2 * imgData.width + x * 2) + 3] > 0)
}

function render () {
    ctx.save()
    ctx.clearRect(0, 0, width, height)
    ctx.fillStyle = 'black'
    ctx.globalAlpha = 0.1
    ctx.font = "120px Helvetica"
    ctx.translate(20, 20)
    renderSentence('Aim for the impossible')
    ctx.restore()

    const textData = ctx.getImageData(0, 0, canvas.width, canvas.height) 
    ctx.fillStyle = 'white'
    ctx.fillRect(0, 0, width, height)

    ctx.strokeStyle = 'black'
    for (let i = 0; i <= width / SPACING; ++i) {
        for (let j = 0; j <= height / SPACING; ++j) {
            const x = j * SPACING
            const y = i * SPACING
            const leftPixelOffset = (isPixelPainted(textData, x - SPACING, y) ? -3 : 0)
            const currentPixelOffset = (isPixelPainted(textData, x, y) ? -3 : 0)
            const topPixelOffset = (isPixelPainted(textData, x, y - SPACING) ? -3 : 0)
            if (x > 0) {
                ctx.beginPath()
                ctx.moveTo(x - SPACING + leftPixelOffset, y + leftPixelOffset) 
                ctx.lineTo(x + currentPixelOffset, y + currentPixelOffset)
                ctx.stroke()
            }
            if (y > 0) {
                ctx.beginPath()
                ctx.moveTo(x + topPixelOffset, y - SPACING + topPixelOffset) 
                ctx.lineTo(x + currentPixelOffset, y + currentPixelOffset)
                ctx.stroke()
            }
        }
    }
}
</script>
<script>
function loop () {
    requestAnimationFrame(loop)
    render()
}
render()

// screenshot generator
document.addEventListener('keypress', function (e) {
    console.log(e)
    if (e.code === "Space") {
        // generate "shot"
        const img = new Image()
        img.width = img.height = 600
        img.src = canvas.toDataURL()
        document.body.appendChild(img)
    }
})
</script>
</body>