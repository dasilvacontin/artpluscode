<!doctype html5>
<head>
    <style>
        html, body {
            width: 100%;
            height: 100%;
            padding: 0;
            margin: 0
        }
        canvas {
            width: 600px;
            height: 600px;
        }
    </style>
</head>
<body>
<script type="text/javascript" src="../dat.gui.min.js"></script>
<script>

let width, height
const canvas = document.createElement('canvas')
const ctx = canvas.getContext('2d')
document.body.appendChild(canvas)
const { random, round, abs, floor, max, PI, sin } = Math
const start = Date.now()
let counter
let last = Date.now()

function getRandomColor () {
    return '#'+(0x1000000+(Math.random())*0xffffff).toString(16).substr(1,6)
}

function ffor00 () {
    return round(random()) ? 'ff' : '00'
}

function getRandomNeonColor () {
    return `#${ffor00()}${ffor00()}${ffor00()}`
}

/*
window.onresize = function () {
    width = window.innerWidth
    height = window.innerHeight
    canvas.width = width * 2
    canvas.height = height * 2
    ctx.scale(2, 2)
}
window.onresize()
*/

width = height = 600
/*
width = window.innerWidth
height = window.innerHeight
/**/
canvas.style.width = canvas.style.height = width
canvas.width = width * 2
canvas.height = height * 2
ctx.scale(2, 2)
</script>
<!--<script src="render.js"></script>-->
<script>
const FPS_ENABLED = false
function renderFPS () {
    ctx.clearRect(0, 0, 50, 20)
    ctx.fillStyle = 'blue'
    ctx.fillText(delta, 20, 20)
}

function loop () {
    requestAnimationFrame(loop)
    counter = Date.now() - start
    delta = Date.now() - last
    last = Date.now()
    window.render && render()
    if (FPS_ENABLED) renderFPS()
}
ctx.fillStyle = 'white'
ctx.fillRect(0,0,width,height)
window.init && init()
loop()


// screenshot generator
document.addEventListener('keypress', function (e) {
    console.log(e)
    if (e.code === "Space") {
        // generate "screenshot"
        const img = new Image()
        img.width = img.height = width
        img.src = canvas.toDataURL()
        document.body.appendChild(img)
    }
})
</script>























































<script>

function randomError (range) {
    return -range/2 + Math.random()*range
}

const params = {
    edge: width/2,
    background: '#f8f8f8',
    offset: 10,
    weight: 0.5,
    fillDisplacement: 5,
    displacementError: 2
}
// actual art code here
function render () {
    const {
        background, edge, offset, weight,
        fillDisplacement, displacementError
    } = params
    
    ctx.fillStyle = background
    ctx.fillRect(0,0,width,height)

    const points = [
        {x: -edge/2, y: -edge/2},
        {x:  edge/2, y: -edge/2},
        {x:  edge/2, y:  edge/2},
        {x: -edge/2, y:  edge/2}
    ]

    ctx.strokeStyle = 'black'
    ctx.lineWidth = weight
    ctx.lineCap = 'round'

    ctx.save()
    ctx.globalAlpha = 0.25
    ctx.translate(width/2,height/2)
    for (let i = 0; i < points.length * 20; ++i) {
        const currP = points[i % points.length]
        const nextP = points[(i+1) % points.length]
        ctx.beginPath()
        ctx.moveTo(currP.x - offset + random()*offset,
                   currP.y - offset + random()*offset)
        ctx.lineTo(nextP.x - offset + random()*offset,
                   nextP.y - offset + random()*offset)
        ctx.stroke()
    }

    let upIt = 0
    let bottomIt = 0
    ctx.strokeStyle = 'blue'
    ctx.beginPath()
    ctx.moveTo(-edge/2 + randomError(displacementError),
               -edge/2 + randomError(displacementError))
    while ((upIt < edge*2) && (bottomIt < edge*2)) {
        if (bottomIt < upIt) {
            bottomIt += fillDisplacement + randomError(displacementError)
            if (bottomIt < edge) {
                ctx.lineTo(-edge/2 + randomError(displacementError),
                           -edge/2 + bottomIt)
            } else {
                ctx.lineTo(-edge/2 + bottomIt - edge,
                            edge/2 + randomError(displacementError))
            }
        } else {
            upIt += fillDisplacement + randomError(displacementError)
            if (upIt < edge) {
                ctx.lineTo(-edge/2 + upIt,
                           -edge/2 + randomError(displacementError))
            } else {
                ctx.lineTo( edge/2 + randomError(displacementError),
                            edge/2 + upIt - edge)
            }
        }
    }
    ctx.stroke()
    ctx.restore()
}

document.addEventListener('mousemove', (e) => {
    // params.offset = (e.pageX/window.innerWidth) * 50
    // params.weight = (e.pageY/window.innerHeight) * 20
})
</script>
    











<script>
const gui = new dat.GUI()
for (let param in params) {
    const value = params[param]
    const isColor = (typeof value === 'string' && value[0] === '#')
    if (isColor) gui.addColor(params, param)
    else gui.add(params, param)
}
</script>
</body>